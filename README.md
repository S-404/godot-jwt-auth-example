
# Пример JWT аутентификации для Godot (v4.4.1)

Пример реализации JWT (JSON Web Token) аутентификации в Godot Engine 4.4.1. Этот проект демонстрирует клиентскую систему аутентификации с автоматическим обновлением токенов, управлением cookies и чистой сервис-ориентированной архитектурой.

## Что демонстрирует этот проект

*   **Полный цикл аутентификации**: Регистрация, Вход, Выход и Обновление токенов
*   **Автоматическое управление токенами**: Автоматически обрабатывает истечение и обновление JWT
*   **Сервисная архитектура**: Чистое разделение ответственности с сервисами, хранилищами и событиями
*   **Поддержка Cookies**: Управление HTTP cookies для сессионной аутентификации
*   **Безопасное хранение**: Зашифрованное локальное хранилище для токенов и чувствительных данных
*   **Обработка ошибок**: Комплексная обработка исключений API с пользовательскими кодами ошибок
*   **Управление сценами**: Управление переходами между сценами через события

## Начало работы

### Предварительные требования

*   **Godot Engine**: Версия **4.4.1** (стабильная)
*   **Бэкенд сервер**: Требуется совместимый бэкенд API. Можно использовать сопутствующий сервер на Go:
    ```bash
    git clone https://github.com/S-404/go-auth-example
    cd go-auth-example
    # далее по инструкции в README для запуска сервера
    ```

### Запуск

Настройте URL сервера:
    - Откройте constants.gd
    - Обновите константу SERVER_URL в соответствии с адресом вашего бэкенда:
        
        const SERVER_URL = "http://localhost:8082/api"  # Измените на URL вашего сервера

Запустите проект:
- Откройте проект в Godot 4.4.1
- Нажмите F5 или кнопку "Run" для запуска


Структура проекта
```
godot-auth-example/
├── Main.tscn                  # Корневая сцена
├── constants.gd               # Глобальные константы
└── src/
    ├── scenes/                # UI сцены
    └── scripts/
        ├── api/               # Слой API коммуникации
        ├── containers/        # Контроллеры сцен
        ├── events/            # Система событий
        ├── exceptions/        # Обработка ошибок
        ├── services/          # Сервисы бизнес-логики
        └── store/             # Управление состоянием
```


### Использование

Процесс аутентификации:

- Первоначальная проверка: При запуске приложения AuthStore проверяет существующие cookies и пытается обновить токен
- Вход: Пользователь вводит учетные данные, система получает JWT токен и refresh токен
- Хранение токенов: Access token сохраняется в безопасном хранилище, cookies управляются через CookieJar

- Защищенные запросы: Все последующие API вызовы автоматически включают Authorization заголовок

- Обновление токенов: Автоматически обновляет токены при получении ответа 401

- Выход: Инвалидирует токены и очищает все данные аутентификации

Все API запросы и ответы логируются с детальной информацией.

### API Endpoints

Проект ожидает следующие endpoint'ы бэкенда:

- POST /auth/register - Регистрация пользователя
- POST /auth/login - Вход пользователя
- POST /auth/refresh - Обновление токена
- POST /auth/logout - Выход пользователя
- POST /action/doSmth - Пример защищенного endpoint'а


### Авторы и зависимости
Лицензия MIT

Godot Engine: https://godotengine.org

AwaitableHTTPRequest: By Swarkin https://github.com/Swarkin/Godot-AwaitableHTTPRequest

Пример бэкенда: https://github.com/S-404/go-auth-example
